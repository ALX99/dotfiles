#!/bin/bash
set -euo pipefail

pacnew_files=$(locate "*.pacnew")

if [ -z "$pacnew_files" ]; then
  echo "No .pacnew files were found on the system"
  exit 0
fi

# Iterate over each .pacnew file
for file in $pacnew_files; do
  # Extract the corresponding original file name
  original=${file%.pacnew}

  git diff "$original" "$file" || true

  printf "%s\n%s\n%s\n" \
    "1] Overwrite old file ($original) with new file ($file)" \
    "2] Delete new file ($file)" \
    "3] Skip"

  read -rn 1 -p "Choose 1-3:"
  case "$REPLY" in
  1) mv -f "$file" "$original" ;;
  2 | *) rm --interactive=never "$file" ;;
  3) continue ;;
  esac

done

